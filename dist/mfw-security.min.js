!function(){"use strict";function a(){var a;this.$get=["$q","$log","$timeout","$rootScope","$mfwSecurityConfig","$injector",function(b,c,d,e,f,g){function h(){var a=y.get();if(angular.isDefined(a)){c.log("Loading stored user information:",a);var b=z.fromStorage(a);this.activate(b)}}function i(b){function d(d){c.log("Stored credentials are still valid."),d===!0?(a=b,u(a)):e()}function e(){c.log("Stored credentials are now invalid. Removing them."),y.clear(),v()}d(!0)}function j(a){var b=z.parse(a)||a;y.set(b),this.activate(b)}function k(){angular.isUndefined(a)&&c.warn("Log out when there's not an active user."),a=void 0,y.clear(),v()}function l(){return a}function m(){return angular.isDefined(l())}function n(b,c){if(angular.isUndefined(a))throw new Error("Not logged user.");c=c||[],angular.isArray(c)||(c=[c]),"add"===b?a.permissions=_.union(a.permissions||[],c):"remove"===b?a.permissions=_.difference(a.permissions||[],c):"set"===b&&(a.permissions=c)}function o(){if(angular.isUndefined(a))throw new Error("Not logged user.");return a?a.permissions:[]}function p(a){var b=s(a),c=o(),d=b.filter(t);return c.length&&d.length>0}function q(b){if(angular.isUndefined(a))throw new Error("Not logged user.");var c=a;c.accessToken=b,y.set(c),w()}function r(a){var b=s(a),c=o(),d=b.filter(t);return c.length&&d.length===b.length}function s(a){return angular.isArray(a)||(angular.isString(a)?a=a.split(","):angular.isObject(a)&&(a=[a])),a}function t(a){var b=!1,c=a;"!"===a.charAt(0)&&(b=!0,c=a.substring(1));var d=o().indexOf(c)!==-1,e=b?!d:d;return e}function u(a){x(f.EVENT_LOGIN,angular.copy(a))}function v(){x(f.EVENT_LOGOUT)}function w(){x(f.EVENT_UPDATE_CREDENTIALS,a)}function x(a,b){e.$broadcast(a,b)}var y=g.get(f.storage||"$mfwSecurityStorageDummy"),z=g.get(f.userInfoParser||"$mfwSecurityParserIdentity"),A={init:h,activate:i,logged:j,logout:k,isLogged:m,me:l,setPermissions:n,refreshAccessToken:q,hasAnyPermission:p,hasAllPermissions:r};return A}]}var b=angular.module("mfw.security",[]);b.run(["$mfwSecurity",function(a){a.init()}]),b.constant("$mfwSecurityConfig",{heartbeatInterval:1e3,currentUserGetter:void 0,storage:"$mfwSecurityStorageCookie",userInfoParser:"$mfwSecurityParserJWT",EVENT_LOGIN:"$mfwSecurityLogin",EVENT_LOGOUT:"$mfwSecurityLogout",EVENT_UPDATE_CREDENTIALS:"$mfwSecurityUpdateCredentials"}),b.provider("$mfwSecurity",a),a.$inject=[],b.factory("$mfwSecurityStorageDummy",function(){return{get:angular.noop,set:angular.noop,clear:angular.noop}})}(),function(){"use strict";function a(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAnyPermission||d.from;c.removeAttr("mfw-sec-has-any-permission");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAnyPermission(f)},h(a)}}}}function b(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAllPermissions||d.from;c.removeAttr("mfw-sec-has-all-permissions");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAllPermissions(f)},h(a)}}}}function c(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function d(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged-out");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function e(){var a=Math.ceil(1e3*Math.random())+1;return"$hasEnoughPermisssion"+a}var f=angular.module("mfw.security");f.directive("mfwSecHasAnyPermission",a),a.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecHasAllPermissions",b),b.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLogged",c),c.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLoggedOut",d),d.$inject=["$compile","$mfwSecurity"]}();
//# sourceMappingURL=mfw-security.min.js.map