!function(){"use strict";function a(){var a;this.$get=["$q","$log","$timeout","$rootScope","$mfwSecurityConfig","$injector",function(b,c,d,e,f,g){function h(){var a=this,d=A.get();return D=b.when(d).then(function(b){if(angular.isDefined(b)){c.log("Loading stored user information:",b);var d=B.fromStorage(b);a.activate(d)}},function(){C=!0})}function i(){return C}function j(a){return angular.isFunction(a)&&D.then(a),D}function k(b){function e(e){c.log("Stored credentials are still valid."),e===!0?(a=b,d(function(){w(a)})):d(f),C=!0}function f(){c.log("Stored credentials are now invalid. Removing them."),A.clear(),x()}e(!0)}function l(a){var b=B.parse(a)||a;A.set(b),this.activate(b)}function m(){angular.isUndefined(a)&&c.warn("Log out when there's not an active user."),a=void 0,A.clear(),x()}function n(){return a}function o(){return angular.isDefined(n())}function p(b,c){if(angular.isUndefined(a))throw new Error("Not logged user.");c=c||[],angular.isArray(c)||(c=[c]),"add"===b?a.permissions=_.union(a.permissions||[],c):"remove"===b?a.permissions=_.difference(a.permissions||[],c):"set"===b&&(a.permissions=c)}function q(){if(angular.isUndefined(a))throw new Error("Not logged user.");return a?a.permissions:[]}function r(a){var b=u(a),c=q(),d=b.filter(v);return c.length&&d.length>0}function s(b){if(angular.isUndefined(a))throw new Error("Not logged user.");var c=a;c.accessToken=b,A.set(c),y()}function t(a){var b=u(a),c=q(),d=b.filter(v);return c.length&&d.length===b.length}function u(a){return angular.isArray(a)||(angular.isString(a)?a=a.split(","):angular.isObject(a)&&(a=[a])),a}function v(a){var b=!1,c=a;"!"===a.charAt(0)&&(b=!0,c=a.substring(1));var d=q().indexOf(c)!==-1,e=b?!d:d;return e}function w(a){z(f.EVENT_LOGIN,angular.copy(a))}function x(){z(f.EVENT_LOGOUT)}function y(){z(f.EVENT_UPDATE_CREDENTIALS,a)}function z(a,b){e.$broadcast(a,b)}var A=g.get(f.storage||"$mfwSecurityStorageDummy"),B=g.get(f.userInfoParser||"$mfwSecurityParserIdentity"),C=!1,D=void 0,E={init:h,isInitialized:i,onInitialized:j,activate:k,logged:l,logout:m,isLogged:o,me:n,setPermissions:p,refreshAccessToken:s,hasAnyPermission:r,hasAllPermissions:t};return E.init().then(function(){C=!0}),E}]}var b=angular.module("mfw.security",[]);b.run(["$mfwSecurity",function(a){}]),b.constant("$mfwSecurityConfig",{heartbeatInterval:1e3,currentUserGetter:void 0,storage:"$mfwSecurityStorageCookie",userInfoParser:"$mfwSecurityParserJWT",EVENT_LOGIN:"$mfwSecurityLogin",EVENT_LOGOUT:"$mfwSecurityLogout",EVENT_UPDATE_CREDENTIALS:"$mfwSecurityUpdateCredentials"}),b.provider("$mfwSecurity",a),a.$inject=[],b.factory("$mfwSecurityStorageDummy",function(){return{get:angular.noop,set:angular.noop,clear:angular.noop}})}(),function(){"use strict";function a(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAnyPermission||d.from;c.removeAttr("mfw-sec-has-any-permission");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAnyPermission(f)},h(a)}}}}function b(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAllPermissions||d.from;c.removeAttr("mfw-sec-has-all-permissions");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAllPermissions(f)},h(a)}}}}function c(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function d(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged-out");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function e(){var a=Math.ceil(1e3*Math.random())+1;return"$hasEnoughPermisssion"+a}var f=angular.module("mfw.security");f.directive("mfwSecHasAnyPermission",a),a.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecHasAllPermissions",b),b.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLogged",c),c.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLoggedOut",d),d.$inject=["$compile","$mfwSecurity"]}();
//# sourceMappingURL=mfw-security.min.js.map