!function(){"use strict";function a(){var a;this.$get=["$q","$log","$timeout","$rootScope","$mfwSecurityConfig","$injector",function(b,c,d,e,f,g){function h(){var a=this,d=z.get();return b.when(d).then(function(b){if(angular.isDefined(b)){c.log("Loading stored user information:",b);var d=A.fromStorage(b);a.activate(d),B=!0}},function(){B=!0})}function i(){return B}function j(b){function e(e){c.log("Stored credentials are still valid."),e===!0?(a=b,d(function(){v(a)})):d(f)}function f(){c.log("Stored credentials are now invalid. Removing them."),z.clear(),w()}e(!0)}function k(a){var b=A.parse(a)||a;z.set(b),this.activate(b)}function l(){angular.isUndefined(a)&&c.warn("Log out when there's not an active user."),a=void 0,z.clear(),w()}function m(){return a}function n(){return angular.isDefined(m())}function o(b,c){if(angular.isUndefined(a))throw new Error("Not logged user.");c=c||[],angular.isArray(c)||(c=[c]),"add"===b?a.permissions=_.union(a.permissions||[],c):"remove"===b?a.permissions=_.difference(a.permissions||[],c):"set"===b&&(a.permissions=c)}function p(){if(angular.isUndefined(a))throw new Error("Not logged user.");return a?a.permissions:[]}function q(a){var b=t(a),c=p(),d=b.filter(u);return c.length&&d.length>0}function r(b){if(angular.isUndefined(a))throw new Error("Not logged user.");var c=a;c.accessToken=b,z.set(c),x()}function s(a){var b=t(a),c=p(),d=b.filter(u);return c.length&&d.length===b.length}function t(a){return angular.isArray(a)||(angular.isString(a)?a=a.split(","):angular.isObject(a)&&(a=[a])),a}function u(a){var b=!1,c=a;"!"===a.charAt(0)&&(b=!0,c=a.substring(1));var d=p().indexOf(c)!==-1,e=b?!d:d;return e}function v(a){y(f.EVENT_LOGIN,angular.copy(a))}function w(){y(f.EVENT_LOGOUT)}function x(){y(f.EVENT_UPDATE_CREDENTIALS,a)}function y(a,b){e.$broadcast(a,b)}var z=g.get(f.storage||"$mfwSecurityStorageDummy"),A=g.get(f.userInfoParser||"$mfwSecurityParserIdentity"),B=!1,C={init:h,isInitialized:i,activate:j,logged:k,logout:l,isLogged:n,me:m,setPermissions:o,refreshAccessToken:r,hasAnyPermission:q,hasAllPermissions:s};return C.init(),C}]}var b=angular.module("mfw.security",[]);b.run(["$mfwSecurity",function(a){}]),b.constant("$mfwSecurityConfig",{heartbeatInterval:1e3,currentUserGetter:void 0,storage:"$mfwSecurityStorageCookie",userInfoParser:"$mfwSecurityParserJWT",EVENT_LOGIN:"$mfwSecurityLogin",EVENT_LOGOUT:"$mfwSecurityLogout",EVENT_UPDATE_CREDENTIALS:"$mfwSecurityUpdateCredentials"}),b.provider("$mfwSecurity",a),a.$inject=[],b.factory("$mfwSecurityStorageDummy",function(){return{get:angular.noop,set:angular.noop,clear:angular.noop}})}(),function(){"use strict";function a(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAnyPermission||d.from;c.removeAttr("mfw-sec-has-any-permission");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAnyPermission(f)},h(a)}}}}function b(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c,d){var f=d.mfwSecHasAllPermissions||d.from;c.removeAttr("mfw-sec-has-all-permissions");var g=e();c.attr("ng-if",g+"()");var h=a(c,null,1500);return function(a){a[g]=function(){return b.isLogged()&&b.hasAllPermissions(f)},h(a)}}}}function c(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function d(a,b){return{restrict:"A",terminal:!0,priority:1001,compile:function(c){c.removeAttr("mfw-sec-if-logged-out");var d=e();c.attr("ng-if",d+"()");var f=a(c,null,1500);return function(a){a[d]=function(){return b.isLogged()},f(a)}}}}function e(){var a=Math.ceil(1e3*Math.random())+1;return"$hasEnoughPermisssion"+a}var f=angular.module("mfw.security");f.directive("mfwSecHasAnyPermission",a),a.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecHasAllPermissions",b),b.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLogged",c),c.$inject=["$compile","$mfwSecurity"],f.directive("mfwSecIfLoggedOut",d),d.$inject=["$compile","$mfwSecurity"]}();
//# sourceMappingURL=mfw-security.min.js.map