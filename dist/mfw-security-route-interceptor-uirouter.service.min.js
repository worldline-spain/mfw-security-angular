!function(){"use strict";function a(){this.$get=["$log","$rootScope","$timeout","$mfwSecurityRouteInterceptorConfig","$mfwSecurity","$state","$mfwSecurityConfig",function(a,b,e,f,g,h,i){function j(){l(),D=f.defaultState,C=u(),b.$on("$stateChangeStart",m),b.$on("$stateChangeError",n),b.$on("$stateChangeSuccess",o),b.$on(i.EVENT_LOGIN,r),b.$on(i.EVENT_LOGOUT,s)}function k(){if(angular.isDefined(E))return[E,F]}function l(){function b(b){a.error("Configuration error:",b)}f.avoidLoginStateWhenLoggedIn===!0&&angular.isUndefined(f.defaultState)&&b("avoidLoginStateWhenLoggedIn=true, defaultState=undefined"),f.forwardToDefaultStateAfterLogin===!0&&angular.isUndefined(f.defaultState)&&b("forwardToDefaultStateAfterLogin=true, defaultState=undefined")}function m(b,c,d){function h(){b.preventDefault(),p(c,d)}var i=g.isInitialized(),j=g.isLogged();v(c)&&j&&f.avoidLoginStateWhenLoggedIn===!0?D?(a.debug("Stopping transition to login state as user is already logged in. Will be redirected to default state",D),h(),e(function(){B(D)})):a.error("Tried to avoid login state for a logged user, but no default state is configured."):i||v(c)||y(c)?x(c,d)?a.debug("Has access to state, continue with state change event."):(a.warn("Stopping transition to state",c.name),h(),z(),f.forwardToLoginAfterStoppedTransition===!0&&B(C)):(a.info("Stopping transition to "+c.name+" because $mfwSecurity is not initialized yet"),h())}function n(b,c,d,e,g,h){401===h.status&&(a.error("State change due to 401 server response. Perform logout."),f.forwardToRestrictedStateAfterLogin===!0&&p(c,d),t())}function o(a,b){v(a)||q()}function p(a,b){E=angular.isString(a)?a:a.name,F=b}function q(){E=void 0,F=void 0}function r(){function b(){f.forwardToDefaultStateAfterLogin===!0&&D&&(a.debug("Transition to default state after login:",D),B(D))}E?(f.forwardToRestrictedStateAfterLogin===!0?(a.log("Redirecting to restricted state after login:",E),B(E,F)):b(),E=null):b()}function s(){f.forwardToLoginAfterLogout===!0&&(C?(a.log("Redirecting to login state after logout."),B(C)):a.warn("There's no configured login state to be redirected after logout."))}function t(){g.logout()}function u(){var b,c=f.loginState;angular.isDefined(c)&&(a.debug("Configured in constants the login state",c),b=h.get(c),b||a.warn("There's no state with name",c));var d=h.get().filter(v);if(d.length>1)throw new Error("More than one state is tagged as login.");if(1===d.length){var e=d[0];b?a.debug("Overriding login state with ",e.name):a.debug("Found login state",e.name),b=e}return b||a.warn("There's no state tagged as login state."),b}function v(a){var b=w(a);return b.login===!0||a.name===f.loginState}function w(a){var b=a.data||{};return c&&(b=b[c]||{}),b}function x(b,c){var d=w(b),e=d.permissions,h=g.isLogged(),i=!0;return y(b)?(a.debug("Public access to state",b.name),i=!0):e?angular.isString(e)||angular.isArray(e)?i=g.hasAnyPermission(e):angular.isObject(e)?e.all?i=g.hasAllPermissions(e.all):e.any?i=g.hasAnyPermission(e.any):a.warn("Unkown permissions setting in state",b.name):a.warn("Unkown permissions setting in state",b.name):f.publicByDefault!==!0?(a.debug("State",b.name,"has no permissions defined, and setting publicByDefault is set to false."),i=h,h?a.debug("User is logged in so he has access to state",b.name):a.debug("User is not logged in so he has no access to state",b.name)):(a.debug("State",b.name,"has no permissions defined, and setting publicByDefault is set to true."),i=!0),i}function y(a){var b=w(a),c=b.permissions;return b["public"]===!0||v(a)||(!c||!c.length)&&f.publicByDefault}function z(){A(d)}function A(a,c){b.$broadcast(a,c)}function B(a,b){h.go(a,b)}var C,D,E,F,G={init:j,currentStoppedTransition:k};return G}]}var b=angular.module("mfw.security.route-interceptor.uirouter",["mfw.security","ui.router"]);b.run(["$mfwSecurityRouteInterceptor",function(a){a.init()}]);var c=null,d="$mfwSecurityStateTransitionStopped";b.constant("$mfwSecurityRouteInterceptorConfig",{publicByDefault:!0,loginState:void 0,defaultState:void 0,forwardToDefaultStateAfterLogin:!1,forwardToLoginAfterLogout:!0,forwardToRestrictedStateAfterLogin:!1,forwardToLoginAfterStoppedTransition:!1,avoidLoginStateWhenLoggedIn:!0}),b.provider("$mfwSecurityRouteInterceptor",a)}();
//# sourceMappingURL=mfw-security-route-interceptor-uirouter.service.min.js.map