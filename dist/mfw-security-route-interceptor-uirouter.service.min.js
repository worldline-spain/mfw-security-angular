!function(){"use strict";function a(){this.$get=["$log","$rootScope","$timeout","$mfwSecurityRouteInterceptorConfig","$mfwSecurity","$state","$mfwSecurityConfig",function(a,b,e,f,g,h,i){function j(){l(),C=f.defaultState,B=t(),b.$on("$stateChangeStart",m),b.$on("$stateChangeError",n),b.$on("$stateChangeSuccess",p),b.$on(i.EVENT_LOGIN,q),b.$on(i.EVENT_LOGOUT,r)}function k(){if(angular.isDefined(D))return[D,E]}function l(){function b(b){a.error("Configuration error:",b)}f.avoidLoginStateWhenLoggedIn===!0&&angular.isUndefined(f.defaultState)&&b("avoidLoginStateWhenLoggedIn=true, defaultState=undefined"),f.forwardToDefaultStateAfterLogin===!0&&angular.isUndefined(f.defaultState)&&b("forwardToDefaultStateAfterLogin=true, defaultState=undefined")}function m(b,c,d){function h(){b.preventDefault(),o(c,d)}var i=g.isLogged();u(c)&&i&&f.avoidLoginStateWhenLoggedIn===!0?C?(a.debug("Stopping transition to login state as user is already logged in. Will be redirected to default state",C),h(),e(function(){A(C)})):a.error("Tried to avoid login state for a logged user, but no default state is configured."):w(c,d)?a.debug("Has access to state, continue with state change event."):(a.warn("Stopping transition to state",c.name),h(),y(),f.forwardToLoginAfterStoppedTransition===!0&&A(B))}function n(b,c,d,e,g,h){401===h.status&&(a.error("State change due to 401 server response. Perform logout."),f.forwardToRestrictedStateAfterLogin===!0&&o(c,d),s())}function o(a,b){D=angular.isString(a)?a:a.name,E=b}function p(){D=void 0,E=void 0}function q(){function b(){f.forwardToDefaultStateAfterLogin===!0&&C&&(a.debug("Transition to default state after login:",C),A(C))}D?(f.forwardToRestrictedStateAfterLogin===!0?(a.log("Redirecting to restricted state after login:",D),A(D,E)):b(),D=null):b()}function r(){f.forwardToLoginAfterLogout===!0&&(B?(a.log("Redirecting to login state after logout."),A(B)):a.warn("There's no configured login state to be redirected after logout."))}function s(){g.logout()}function t(){var b,c=f.loginState;angular.isDefined(c)&&(a.debug("Configured in constants the login state",c),b=h.get(c),b||a.warn("There's no state with name",c));var d=h.get().filter(u);if(d.length>1)throw new Error("More than one state is tagged as login.");if(1===d.length){var e=d[0];b?a.debug("Overriding login state with ",e.name):a.debug("Found login state",e.name),b=e}return b||a.warn("There's no state tagged as login state."),b}function u(a){var b=v(a);return b.login===!0||a.name===f.loginState}function v(a){var b=a.data||{};return c&&(b=b[c]||{}),b}function w(b,c){var d=v(b),e=d.permissions,h=g.isLogged(),i=!0;return x(b)?(a.debug("Public access to state",b.name),i=!0):e?angular.isString(e)||angular.isArray(e)?i=g.hasAnyPermission(e):angular.isObject(e)?e.all?i=g.hasAllPermissions(e.all):e.any?i=g.hasAnyPermission(e.any):a.warn("Unkown permissions setting in state",b.name):a.warn("Unkown permissions setting in state",b.name):f.publicByDefault!==!0?(a.debug("State",b.name,"has no permissions defined, and setting publicByDefault is set to false."),i=h,h?a.debug("User is logged in so he has access to state",b.name):a.debug("User is not logged in so he has no access to state",b.name)):(a.debug("State",b.name,"has no permissions defined, and setting publicByDefault is set to true."),i=!0),i}function x(a){var b=v(a),c=b.permissions;return b["public"]===!0||u(a)||(!c||!c.length)&&f.publicByDefault}function y(){z(d)}function z(a,c){b.$broadcast(a,c)}function A(a,b){h.go(a,b)}var B,C,D,E,F={init:j,currentStoppedTransition:k};return F}]}var b=angular.module("mfw.security.route-interceptor.uirouter",["mfw.security","ui.router"]);b.run(["$mfwSecurityRouteInterceptor",function(a){a.init()}]);var c=null,d="$mfwSecurityStateTransitionStopped";b.constant("$mfwSecurityRouteInterceptorConfig",{publicByDefault:!0,loginState:void 0,defaultState:void 0,forwardToDefaultStateAfterLogin:!1,forwardToLoginAfterLogout:!0,forwardToRestrictedStateAfterLogin:!1,forwardToLoginAfterStoppedTransition:!1,avoidLoginStateWhenLoggedIn:!0}),b.provider("$mfwSecurityRouteInterceptor",a)}();
//# sourceMappingURL=mfw-security-route-interceptor-uirouter.service.min.js.map